<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><meta name="keywords" content="null"><meta name="description" content="&lt;p&gt;Goal: Create a modern single-board SNES portable using original hardware. Zero compromise with regard to video and audio quality. Long battery life, slim profile, high-quality D-pad/buttons/triggers. &lt;/p&gt;
&lt;p&gt;&lt;img src"><meta name="author" content="mks"><title>αSNES Prototype - mks.gs</title><meta description="Goal: Create a modern single-board SNES portable using original hardware. Zero compromise with regard to video and audio quality. Long battery life, slim profile, high-quality D-pad&amp;#x2F;buttons&amp;#x2F;triggers."><meta property="og:type" content="article"><meta property="og:title" content="αSNES Prototype"><meta property="og:url" content="mks.gs/2020/11/30/%CE%B1SNES-Prototype/"><meta property="og:site_name" content="mks.gs"><meta property="og:description" content="Goal: Create a modern single-board SNES portable using original hardware. Zero compromise with regard to video and audio quality. Long battery life, slim profile, high-quality D-pad&amp;#x2F;buttons&amp;#x2F;triggers."><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2020-12-01T04:49:10.000Z"><meta property="article:modified_time" content="2020-12-01T10:32:25.115Z"><meta property="article:author" content="mks"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/avatar.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"mks.gs/2020/11/30/%CE%B1SNES-Prototype/"},"headline":"αSNES Prototype","image":["/img/avatar.png"],"datePublished":"2020-12-01T04:49:10.000Z","dateModified":"2020-12-01T10:32:25.115Z","author":{"@type":"Person","name":"mks"},"description":"Goal: Create a modern single-board SNES portable using original hardware. Zero compromise with regard to video and audio quality. Long battery life, slim profile, high-quality D-pad&#x2F;buttons&#x2F;triggers."}</script><link rel="alternative" href="/atom.xml" title="mks.gs" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.12/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/e-style.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="mks.gs" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">home</a><a class="navbar-item" href="https://mks.gs/categories/projects">projects</a><a class="navbar-item" href="https://mks.gs/categories/musings">musings</a><a class="navbar-item" href="/music">music</a><a class="navbar-item" href="/about">about</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-11-30  </div></div><h1 class="title is-3 is-size-4-mobile">αSNES Prototype</h1><div class="content"><p>Goal: Create a modern single-board SNES portable using original hardware. Zero compromise with regard to video and audio quality. Long battery life, slim profile, high-quality D-pad/buttons/triggers. </p>
<p><img src="/img/%CE%B1SNES/preview.png"></p>
<p>I first started thinking about this project back in early 2020 after getting I2S audio working on the SNES. I thought it would be a shame to make a SNES portable that had digital audio but crappy composite video like most SNES portables. Why not go all the way?</p>
<p>Portable SNES clones like the FC16Go and SupaBoy have been around for a long time, but they suffer from tons of issues, like color and sound problems, and incompatibility with certain titles like Earthbound (due to its anti-piracy features) and many PAL games. Also the overall quality of these things is garbage-tier. They all use composite video, analog audio, and the cart slot in the FC16Go is literally attached to the main PCB with 0.1” pin headers:</p>
<p><img src="/img/%CE%B1SNES/fc162.jpg"></p>
<p>FPGA solutions with perfect compatibility either can’t read real carts (MiSTer) or are extremely expensive and closed-source (Super NT.) Obviously original hardware is still the best option if you want to play real SNES/SFC carts.</p>
<p>The other thing to mention is that all clone hardware I’ve seen replicates the “2-Chip” SNES with two PPUs rather than the later 1-Chip revision. This has a few implications: one, lower quality analog RGB video since the 1Chip has a cleaner signal; two, more complex netlist and layout; and three, the 2-Chip has the potential for digital video output.</p>
<h2 id="Motherboard-Redesign"><a href="#Motherboard-Redesign" class="headerlink" title="Motherboard Redesign"></a>Motherboard Redesign</h2><p>Anyway, to make a single-PCB SNES portable a motherboard redesign was obviously required. I sanded down a SNES Jr. motherboard to cross-reference the various 1-Chip SNES schematics floating around on the web. SNES Jr.s are the easiest way to get a guaranteed 1-Chip SNES and aren’t much more expensive than a regular SNES or SFC nowadays. My primary schematic reference so far has been a very nice PAL 1-Chip schematic made by arzi84, so many thanks to them.</p>
<p><img src="/img/%CE%B1SNES/layers.jpg"></p>
<p>I made footprints for the 1-Chip ICs, so the CPU, sound processor, Work RAM and video RAM, CIC, and S-RGB, and put together a 1-Chip mobo redesign. I went ahead and incorporated battery charging with a bq25790 and digital audio with an lm49450. It’s 4-layer PCB to make routing easy. No reason to bother with two-layer anymore IMO since they cost basically the same nowadays. The SNES core is powered by a 5V boost from a single li-ion cell. The cart slot is on a separate daughterboard and is connected through a 64-conductor FFC.</p>
<p><img src="/img/%CE%B1SNES/%CE%B1SNES.png"></p>
<p>The SNES’s sound processor, S-APU, has a very similar footprint (TQFP-100) to the Dreamcast’s AICA sound processor (TQFP-128.) The SNES APU was made by Sony, while the AICA was made by Yamaha. I wonder if the rectangular TQFP package is popular with audio processors for some obscure VLSI reason. </p>
<p>The mobo and cart slot board have been ordered, so hopefully I’ll have some time to assemble and test them in the coming months. </p>
<h2 id="αSNES-Design"><a href="#αSNES-Design" class="headerlink" title="αSNES Design"></a>αSNES Design</h2><p>The SNES core reimplementation is the easy part of this project. There are lots of other nifty features I want to have that make things a tad more challenging. </p>
<h3 id="Internal-flashcart"><a href="#Internal-flashcart" class="headerlink" title="Internal flashcart"></a>Internal flashcart</h3><p>One of these features is an internal SD2SNES, so if you want to play a bunch of games on the go you don’t necessarily have to lug your carts around. Or, more specifically, this will let me play games like Super Metroid and Yoshi’s Island on my physical carts and keep my saves handy, while also letting me play translations for stuff like Shin Megami Tensei easily through the SD2SNES. </p>
<p>This feature requires lots of interesting circuitry. For one, the entire cartridge bus has to be muxed between the physical cart slot and the internal SD2SNES. These are 5V signals, so 5V TTL tolerant muxes are needed. (SD2SNES already has logic level converters since it runs at 3.3V.) </p>
<h3 id="Audio"><a href="#Audio" class="headerlink" title="Audio"></a>Audio</h3><p>SD2SNES also has the ability to run MSU-1 games with enhanced CD-quality audio by removing the cartridge size limit and adding a special coprocessor in the FPGA fabric. This audio is normally piped over the stereo aux channels on the cart slot. But the FPGA in SD2SNES naturally generates I2S audio before it’s DAC’d into the cart slot. Obviously I want to take out the middle man here, so αSNES will use the very sexy LM49350 audio amp, which has two separate I2S input channels and a digital mixer. This way I can mix the digital MSU-1 audio from SD2SNES if it’s being used with the SNES digital audio for pure digital CD-quality audio. </p>
<p>For full compatibility, I have to take into account the aux channels on the physical cart slot, too. If you plugged in a standalone SD2SNES or a Super Game Boy, the cart would pump analog audio through the aux channels. This audio will be piped into the LM49350’s analog input channel. I’m thinking of just having a pushbutton to cycle through the different audio modes (SNES only, SNES+MSU-1 from internal SD2SNES, SNES+analog from cart slot) to make things simple.</p>
<h3 id="Saves"><a href="#Saves" class="headerlink" title="Saves"></a>Saves</h3><p>I considered integrating a save dumper/flasher into αSNES, but to be honest it seems like it would be more hassle to implement 3:1 muxing for the cart slot than to just use an external cartreader for dumping saves to put on the SD2SNES SD card. So, this isn’t a feature I’ll have.</p>
<h3 id="Video"><a href="#Video" class="headerlink" title="Video"></a>Video</h3><p>This is the big one, and the major reason why αSNES is a thing. So, as discussed earlier, by using original 1-Chip hardware we automatically gain analog video quality over SNES clone hardware based on the 2-Chip PPU circuitry. But how do we use 15KHz RGBs in a portable? I don’t want to screw around with writing firmware for MST703 and repurposing the ZJ050NA-08C driver board to accept it. Then there’s the issue of most LCD drivers treating 240p input signals as 480i, which looks ugly and generally sucks. The MST703 might have a way around this, but why screw around with it this much? Ideally we need a way to clean up and linedouble the RGBs signal before driving anything with it.</p>
<p>Initially I wanted to integrate an OSSC into αSNES, but despite it being OSHW the software is pretty bloated since it has a softcore to handle the user interface and digital audio. αSNES doesn’t need anything beyond linedoubling and possibly retiming a bit, so the OSSC is overkill. I could use ADCs and an FPGA to linedouble, but due to a major SNES video revelation, I am OK with reimplementing the perfectly capable GBS8200 board, which is based on the Tvia Trueview5725 scaler. With the custom GBScontrol firmware, the Trueview5725 can do really excellent linedoubling that’s comparable to the OSSC. So I’ve ordered some GBS8200s to reverse engineer so I can implement a Trueview5725 linedoubler on the αSNES PCB. This way I can feed perfectly scaled 640x480 VGA to my ZJ050NA-08C LCD with zero hassle. It should look amazing.</p>
<p>With all that being said, it turns out this is still a compromise. Some folks on the circuitboard.de forums figured out how to coax digital video out of the 2-Chip SNES’s PPU2 by setting some debug pins high and low. Opatus over on shmups.system11 went even further and managed to feed some blanking signals exposed on PPU pins into a CPLD and clean up the digital video data to be usable. Opatus is feeding the digital video into his own DACs for super crispy RGBs, but I see potential here for a pure-digital video mod. Once Opatus releases his work on conditioning the video data, I can use a CPLD or FPGA to linedouble and retime this to drive the ZJ050NA-08C directly. But, that’s probably a long way off, so for the time being I am sticking to analog-only 1-Chip circuitry and the Trueview5725 as the “next-best thing.”</p>
<p>Note: The 1-Chip, which contains the PPUs and CPU in a single die, does have the debug pins and test port found on PPU2 of the 2-Chip. So, in theory you might be able to get digital video out of the 1-Chip too, meaning my work on the 1-Chip mobo redesign could be carried over to a pure-digital version of αSNES. BUT the 1-Chip doesn’t expose the blanking signals that Opatus used to cull certain artifacts from the digital video data, so I’m not entertaining this notion. A pure-digital SNES mobo redesign will have to be a 2-Chip.</p>
<p>I don’t really like compromising on video quality and using analog when I know pure digital is technically possible, but oh well. I’ll get around to the digital version eventually.</p>
<h3 id="Controls"><a href="#Controls" class="headerlink" title="Controls"></a>Controls</h3><p>This is something I’ve devoted a lot of thought to, and I’m happy with what I’ve come up with. My criterion for the quality of a d-pad (the most important part of a SNES controller IMO) is whether it’s easy for me to perpetually wall-jump against a single wall in Super Metroid. The PS Vita d-pad is the best for this since it’s got a strong pivot and super clicky metal domes. The actual SNES d-pad is OK, but too mushy for my taste, and lots of other d-pads like Wiimote, Wii Classic Controller Pro, Wii U Gamepad, etc. don’t have enough tactile feedback. The obvious choice <em>would</em> be the Switch Pro Controller, but it’s got a really shitty d-pad that doesn’t pivot nicely for some reason. Well, after much fiddling I found that a combination of the “tape fix” that partially covers the button contacts and raising the pivot ever so slightly results in a ProCon d-pad that’s nearly as good as the Vita’s in my Super Metroid walljump test. No more ghost inputs, much better pivoting, and the solid tactile feel remains. So this portable will use Switch Pro Controller buttons. This is fitting with the “modern SNES portable” theme I’m going for.</p>
<p>As for the Switch Pro triggers, I’m going to scan the FPC that they use for their membrane buttons and make a separate replacement FPC for each side. This will be really easy to do and make for a super clean install, since I can just have a ZIF on the back of the PCB for the triggers to plug into.</p>
<h3 id="Batteries"><a href="#Batteries" class="headerlink" title="Batteries"></a>Batteries</h3><p>1S2P 18650 cells, positioned under the triggers and behind the buttons/d-pad. I’m estimating around 4 to 5 hours of battery life depending on the cart being played. </p>
<br />

<h2 id="Next-steps"><a href="#Next-steps" class="headerlink" title="Next steps:"></a>Next steps:</h2><p>*Assemble αSNES prototype board, get carts booting<br>*Test GBS8200 and get VGA working</p>
<p>Future work:</p>
<p>*Cart muxing prototype PCB<br>*Trueview5725 prototype PCB<br>*LM49350 prototype PCB<br>*SD2SNES reimplementation on new PCB</p>
</div><div></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/09/25/aveflex/"><span class="level-item">AVEflex</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><!--!--><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="/img/avatar.png" alt="mks"></figure><p class="title is-size-4 is-block line-height-inherit">mks</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://weibo.com/u/3050419984" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Spotify" href="https://open.spotify.com/user/proteanclover"><i class="fab fa-spotify"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Reddit" href="https://reddit.com/u/ProteanClover"><i class="fab fa-reddit"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:floralyveltalgriffin@gmail.com"><i class="fa fa-envelope"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-01T04:49:10.000Z">2020-11-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/11/30/%CE%B1SNES-Prototype/">αSNES Prototype</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/projects/">projects</a> / <a class="link-muted" href="/categories/projects/%CE%B1SNES/">αSNES</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-09-25T16:46:06.000Z">2020-09-25</time></p><p class="title is-6"><a class="link-muted" href="/2020/09/25/aveflex/">AVEflex</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/projects/">projects</a> / <a class="link-muted" href="/categories/projects/wii/">wii</a> / <a class="link-muted" href="/categories/projects/wii/aveflex/">aveflex</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=mksgsFeedsId&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="mksgsFeedsId" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div><p class="help">Subscribe to receive updates</p></form></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="mks.gs" height="78"></a></div><div class="level-end"></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'mks.gs',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back-to-top.js" defer></script><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.12/js/lightgallery-all.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><!--!--><!--!--><!--!--><script src="/js/toc.js" defer></script><script src="/js/main.js" defer></script><link rel="stylesheet" href="/css/insight.css"><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Type something..."><span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>(function (window) {
            var INSIGHT_CONFIG = {
                TRANSLATION: {
                    POSTS: 'Posts',
                    PAGES: 'Pages',
                    CATEGORIES: 'Categories',
                    TAGS: 'Tags',
                    UNTITLED: '(Untitled)',
                },
                CONTENT_URL: '/content.json',
            };
            window.INSIGHT_CONFIG = INSIGHT_CONFIG;
        })(window);</script><script src="/js/insight.js" defer></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(false){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('undefined','undefined','undefined','undefined',undefined);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>